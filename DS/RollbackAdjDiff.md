### 一、模板类别

​	数据结构：回滚前缀和。

​	练习题目：

1. [数学考试](https://ac.nowcoder.com/acm/problem/15553)
2. [1481:Maximum sum](http://noi.openjudge.cn/ch0206/1481)


### 二、模板功能

#### 1.初始化

1. 数据类型

   类型设定 `size_type = uint32_t` ，表示数组大小、编号的类型。

   模板参数 `typename Commutative` ，表示交换群类型。

   构造参数 `size_type length`  ，表示维护的区间下标范围为 `[0, length-1]` 。

   构造参数 `InitMapping mapping` ，表示在初始化时，从下标到值的映射函数。

2. 时间复杂度

    $O(n)$ 。

3. 备注

   本模板通过模板参数 `typename CommutativeGroup` 确定交换群。交换群须满足以下要求：

1. 声明 `value_type` 为值类型；

2. 定义静态函数 `op` ，接受两个 `value_type` 参数，返回它们的聚合值；

3. 定义静态函数 `identity` ，无输入参数，返回幺元。

4. 定义静态函数 `inverse` ，输入参数一个 `value_type` ，返回其逆元。

    本模板要求区间操作函数的运算符满足**结合律**和**交换律**。常见的交换群为加法群和异或群。
   
   本数据结构维护一个区间的前缀和，可以快速查询已有部分的区间和。

   本模板与 `AdjDiff` 模板的区别为，本模板支持回滚操作，区间长度是可以动态变化的。

#### 2.初始化

1. 数据类型

   构造参数 `Iterator first` ，表示区间维护的区间头。

   构造参数 `Iterator last` ，表示区间维护的区间尾。（开区间）

   其它同上。

2. 时间复杂度

   同上。

3. 备注

   同上。

   使用迭代器进行初始化，可以将区间初状态直接赋到表里。

#### 3.重置(resize)

1. 数据类型

   输入参数 `size_type length`  ，表示维护的行范围为 `[0, length-1]` 。

   输入参数 `InitMapping mapping` ，表示在初始化时，从下标到值的映射函数。

2. 时间复杂度

    $O(n)$ 。

3. 备注

   使用映射函数进行初始化，可以将区间初状态直接赋到差分表里。

   构造参数中的 `mapping` 参数，入参为下标，返回值须为一个 `value_type` 对象。在调用时，会按照行下标从 `0` 到 `length-1` 依次调用。
   
   本函数没有进行参数检查，所以请自己确保下标合法。（位于 `[0，n)`）

#### 4.重置(reset)

1. 数据类型

   输入参数 `Iterator first` ，表示区间维护的区间头。

   输入参数 `Iterator last` ，表示区间维护的区间尾。（开区间）

2. 时间复杂度

   同上。

3. 备注

   同上。

   使用迭代器进行重置，可以将区间初状态直接赋到表里。

#### 5.单点查询(query)

1. 数据类型

   输入参数 `size_type i` ，表示要查询的点所在下标。

2. 时间复杂度

   $O(1)$ 。

3. 备注

   本函数没有进行参数检查，所以请自己确保下标合法。（行号位于 `[0，n)`）

#### 6.区间查询(query)

1. 数据类型

   输入参数 `size_type left` ，表示要查询的子数组的开始下标。

   输入参数 `size_type right` ，表示要查询的子矩形的结尾下标。（闭区间）

2. 时间复杂度

   $O(1)$ 。

3. 备注

   本函数没有进行参数检查，所以请自己确保下标合法。（行号位于 `[0，n)`）

#### 7.查询全部(query_all)

1. 数据类型

2. 时间复杂度

   $O(1)$ 。

#### 8.在尾部插入元素(push_back)

1. 数据类型

   输入参数 `value_type x` ，表示要插入的元素。

2. 时间复杂度

   $O(1)$ 。

#### 9.删除尾部元素(pop_back)

1. 数据类型

2. 时间复杂度

   $O(1)$ 。
   
#### 10.查询数组大小(size)

1. 数据类型

   返回类型 `size_type` ，表示查询结果。
   
2. 时间复杂度

   $O(1)$ 。
   
#### 11.查询数组是否为空(empty)

1. 数据类型

   返回类型 `bool` ，表示查询结果。
   
2. 时间复杂度

   $O(1)$ 。

#### 12.清空数组(clear)

1. 数据类型
   
2. 时间复杂度

   $O(n)$ 。
   
#### 13.预留空间(reserve)

1. 数据类型

   输入参数 `size_type capacity` ，表示要预留的空间大小。
   
2. 时间复杂度

   $O(n)$ 。

### 三、模板示例

```c++
#include "DS/RollbackAdjDiff.h"
#include "IO/FastIO.h"

int main() {
    using Vec = OY::RollbackSumTable<int>;

    Vec a;
    a.push_back(100);
    a.push_back(80);
    a.push_back(50);

    a.pop_back();
    a.push_back(90);

    cout << a << endl;

    a.push_back(1000);
    cout << a << endl;
}
```

```
#输出如下
[100, 80, 90]
[100, 80, 90, 1000]

```

