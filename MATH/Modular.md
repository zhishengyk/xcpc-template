### 一、模板类别

​	数学：静态取模。

### 二、模板功能

#### 1.构造

1. 数据类型

   模板参数 `typename _ModType` ，可以为 `uint32_t` 或者 `uint64_t` ，表示模数的类型。

   模板参数 `_ModType _P` ，表示模数。

2. 时间复杂度

   $O(1)$ 。

3. 备注

   本模板用于静态取模。所谓静态，是指模数在编译期已经确定。由于编译器的优化往往较为高效，所以如果采用巴雷特约减或者蒙哥马利约减反而会降低效率。因此在这种情况下，采用最简单的写法反而最快。

#### 2.查询模数

1. 数据类型

2. 时间复杂度

   $O(1)$ 。

#### 3.快速求余

1. 数据类型

   输入参数 `uint64_t __a` ，表示要求余的数。要求传入非负数。

2. 时间复杂度

   $O(1)$ ，包含一次取模运算（除法运算）。
   
#### 4.快速加法

1. 数据类型

   输入参数 `_ModType __a` ，表示第一个加数。

   输入参数 `_ModType __b` ，表示第二个加数。

2. 时间复杂度

   $O(1)$ ，无复杂运算。

3. 备注

   本函数返回和的模值。

   **注意：**本函数要求输入的两个加数都已取模。

#### 5.快速减法

1. 数据类型

   输入参数 `_ModType __a` ，表示被减数。

   输入参数 `_ModType __b` ，表示减数。

2. 时间复杂度

   $O(1)$ ，无复杂运算。

3. 备注

   本函数返回差的模值。

   **注意：**本函数要求输入的两个加数都已取模。

#### 6.快速乘法

1. 数据类型

   输入参数 `uint64_t __a` ，表示第一个乘数。

   输入参数 `uint64_t __b` ，表示第二个乘数。

2. 时间复杂度

   $O(1)$ 。

3. 备注

   如果 `_ModType` 为 `uint64_t` ，采取 `long double` 乘法；如果 `_ModType` 为 `uint32_t` ，采取 `64` 位乘法。

   **注意：** 因为本函数在 `64` 位下采取 `long double` 乘法，所以在 `64` 位下要求模数 `m_P` 在 `[2, 2^63)` 范围内，且 `__a*__b<m_P^2`  。

#### 7.64 位乘法

1. 数据类型

   输入参数 `uint64_t __a` ，表示第一个乘数。

   输入参数 `uint64_t __b` ，表示第二个乘数。

2. 时间复杂度

   $O(1)$ ，包含一次乘法运算和一次除法运算。

3. 备注

   **注意：** 本函数要求乘积在 `64` 位表示范围内。

#### 8. 128 位乘法

1. 数据类型

   输入参数 `uint64_t __a` ，表示第一个乘数。

   输入参数 `uint64_t __b` ，表示第二个乘数。

2. 时间复杂度

   $O(1)$ ，如果调用 `64` 位乘法，包含一次乘法运算和一次除法运算；否则包含一次 `128` 位乘法运算和一次取模运算（除法运算）。

#### 9. long double 乘法

1. 数据类型

   输入参数 `uint64_t __a` ，表示第一个乘数。

   输入参数 `uint64_t __b` ，表示第二个乘数。

2. 时间复杂度

   $O(1)$ ，如果调用 `64` 位乘法，包含一次乘法运算和一次除法运算；否则包含一次 `64` 位乘法运算，两次浮点乘算和一次浮点除算。

3. 备注

   **注意：** 本函数要求模数 `m_P` 在 `[2, 2^63)` 范围内，且 `__a*__b<m_P^2`  。

   **注意：** 一般情况下本函数比 `128` 位乘法的速度更快。但是本函数不能用于 `2^63` 以上的模数，而且在 `loj` 等少数平台，本函数速度慢于 `128` 位乘法。如果有这样的情况，可以将所有用到 `multiply_ld` 的地方替换为 `multiply_128` ；或者直接将 `multiply_ld` 的实现替换为 `multiply_128` 的实现。

#### 10.快速幂

1. 数据类型

   输入参数 `uint64_t __a` ，表示底数。

   输入参数 `uint64_t __n` ，表示指数。

2. 时间复杂度

   $O(\log n)$ 。

3. 备注

   如果 `_ModType` 为 `uint64_t` ，采取 `long double` 快速幂；如果 `_ModType` 为 `uint32_t` ，采取 `64` 位快速幂。

   **注意：** 因为本函数在 `64` 位下采取 `long double` 快速幂，所以在 `64` 位下要求模数 `m_P` 在 `[2, 2^63)` 范围内。

#### 11. 64 位快速幂

1. 数据类型

   输入参数 `uint64_t __a` ，表示底数。

   输入参数 `uint64_t __n` ，表示指数。

2. 时间复杂度

   $O(\log n)$ ，包含对数次乘法运算和除法运算。

3. 备注
   
   **注意：**本函数只适用于模数在 `32` 位范围内的情况。

#### 12. 128 位快速幂

1. 数据类型

   输入参数 `uint64_t __a` ，表示底数。

   输入参数 `uint64_t __n` ，表示指数。

2. 时间复杂度

   $O(\log n)$ ，包含对数次 `128` 位乘法运算，无除法运算。

3. 备注

   在每一步乘法计算中，调用 `128` 位乘法。

#### 13. long double 快速幂

1. 数据类型

   输入参数 `uint64_t __a` ，表示底数。

   输入参数 `uint64_t __n` ，表示指数。

2. 时间复杂度

   $O(\log n)$ ，包含对数次 `long double` 乘法运算，无除法运算。

3. 备注

   在每一步乘法计算中，调用 `long double` 位乘法。

   **注意：**本函数要求模数 `m_P` 在 `[2, 2^63)` 范围内。

#### 14.快速除法

1. 数据类型

   模板参数 `typename _Tp` ，表示被除数类型。

   输入参数 `_Tp __a` ，表示被除数。

2. 时间复杂度

   $O(1)$ ，包含一次除法运算。
   
#### 15.快速带余除法

1. 数据类型

   模板参数 `typename _Tp` ，表示被除数类型。

   输入参数 `_Tp __a` ，表示被除数。

   返回类型 `std::pair<_Tp, _Tp>` ，表示商和余数。

2. 时间复杂度

   $O(1)$ ，包含一次乘法运算和一次除法运算。

### 三、模板示例

```c++
#include "IO/FastIO.h"
#include "MATH/Modular.h"

int main() {
    //设置模数为 1000000007
    OY::Modular32<1000000007>md;
    cout << "md's mod number:" << md.mod() << endl;
    cout << "1596842379856 mod 1000000007 = " << md.mod(1596842379856) << endl;
    cout << "59865278 * 59846223 mod 1000000007 = " << md.multiply(59865278, 59846223) << endl;
    cout << "pow(2,100) mod 1000000007 = " << md.pow(2, 100) << endl;
    cout << "12345678987654321 // 1000000007 = " << md.divide(12345678987654321) << endl;
    auto [quo, rem] = md.divmod(1596842379856);
    cout << "1596842379856 = " << quo << " * 1000000007 + " << rem << endl;

    //如果想改变模数，可以重新声明一个类
    OY::Modular32<233>md2;
    cout << "md2's mod number:" << md2.mod() << endl;
}
```

```
#输出如下
md's mod number:1000000007
1596842379856 mod 1000000007 = 842368684
59865278 * 59846223 mod 1000000007 = 752066024
pow(2,100) mod 1000000007 = 976371285
12345678987654321 // 1000000007 = 12345678
1596842379856 = 1596 * 1000000007 + 842368684
md2's mod number:233

```

